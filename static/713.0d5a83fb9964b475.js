"use strict";(self.webpackChunkelog_web=self.webpackChunkelog_web||[]).push([[713],{713:(re,g,a)=>{a.r(g),a.d(g,{ArchiveModule:()=>le});var u=a(6895),d=a(3060),v=a(5017),l=a(3626),A=a(7030),_=a(8739),f=a(5150),e=a(4650),C=a(3248);let T=(()=>{class i{constructor(t){this.httpDataService=t}getArchiveActivities(){return this.httpDataService.get("activity/archive/activities")}postRestoreSelectedActivities(t){return this.httpDataService.post("activity/archive/multiple",t)}postDeleteSelectedActivities(t){return this.httpDataService.post("activity/delete/multiple",t)}restoreDocuments(t){return this.httpDataService.post("activity/document/archive/revert",t)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(C.L))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var S=a(2653),x=a(6918),b=a(5641),Z=a(9642),y=a(4859),k=a(3546),D=a(6709),N=a(7392),h=a(8255),p=a(3848);function w(i,c){1&i&&(e.TgZ(0,"div",23)(1,"mat-icon"),e._uU(2,"assignment"),e.qZA(),e._uU(3," Tasks "),e.qZA())}function O(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"th",24)(1,"mat-checkbox",25),e.NdJ("change",function(o){e.CHM(t);const s=e.oxw();return e.KtG(o?s.masterToggle():null)}),e.qZA(),e.TgZ(2,"button",26)(3,"mat-icon"),e._uU(4,"arrow_drop_down"),e.qZA()()()}if(2&i){const t=e.oxw(),n=e.MAs(57);e.xp6(1),e.Q6J("checked",t.selection.hasValue()&&t.isAllSelected())("indeterminate",t.selection.hasValue()&&!t.isAllSelected()),e.xp6(1),e.Q6J("disabled",0===t.selection.selected.length)("matMenuTriggerFor",n)}}function U(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"td",27)(1,"mat-checkbox",28),e.NdJ("click",function(o){return o.stopPropagation()})("change",function(o){const r=e.CHM(t).$implicit,m=e.oxw();return e.KtG(o?m.selection.toggle(r):null)}),e.qZA()()}if(2&i){const t=c.$implicit,n=e.oxw();e.xp6(1),e.Q6J("checked",n.selection.isSelected(t))}}function M(i,c){1&i&&(e.TgZ(0,"th",24),e._uU(1," Activity "),e.qZA())}function F(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"td",29),e.NdJ("click",function(){const s=e.CHM(t).$implicit,r=e.oxw();return e.KtG(r.navigateToActivityDetails(s._id))}),e._uU(1),e.qZA()}if(2&i){const t=c.$implicit;e.xp6(1),e.hij(" ",t.uniqIdentity?t.uniqIdentity:t.createdByOrganizationData[0].shortName," ")}}function z(i,c){1&i&&(e.TgZ(0,"th",24),e._uU(1," Title "),e.qZA())}function Y(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"td",29),e.NdJ("click",function(){const s=e.CHM(t).$implicit,r=e.oxw();return e.KtG(r.navigateToActivityDetails(s._id))}),e._uU(1),e.qZA()}if(2&i){const t=c.$implicit;e.xp6(1),e.hij(" ",t.title," ")}}function J(i,c){1&i&&(e.TgZ(0,"th",30),e._uU(1," Status "),e.qZA())}const P=function(i,c,t,n){return{"badge-not-admissible":i,"badge-resolved":c,"badge-in-progress":t,"badge-new":n}};function I(i,c){if(1&i&&(e.TgZ(0,"td",31)(1,"span",32),e._uU(2),e.ALo(3,"titlecase"),e.qZA()()),2&i){const t=c.$implicit;e.xp6(1),e.Q6J("ngClass",e.l5B(4,P,"rejected"===(null==t?null:t.status.toLowerCase()),"resolved"===(null==t?null:t.status.toLowerCase()),"inprogress"===(null==t?null:t.status.toLowerCase()),"new"===(null==t?null:t.status.toLowerCase()))),e.xp6(1),e.hij(" ",e.lcZ(3,2,t.status)," ")}}function Q(i,c){1&i&&(e.TgZ(0,"th",24),e._uU(1," Organisation "),e.qZA())}function L(i,c){if(1&i&&(e.TgZ(0,"td",27),e._uU(1),e.qZA()),2&i){const t=c.$implicit;e.xp6(1),e.hij("",t.createdByOrganizationData[0].organization," ")}}function R(i,c){1&i&&e._UZ(0,"tr",33)}function q(i,c){1&i&&e._UZ(0,"tr",34)}function B(i,c){1&i&&(e.TgZ(0,"div")(1,"mat-card",35),e._uU(2," No Archived Activities found "),e.qZA()())}function $(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",36),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.logSelection())}),e.TgZ(1,"mat-icon"),e._uU(2,"attachment"),e.qZA(),e._uU(3," Files "),e.qZA()}}function H(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"th",24)(1,"mat-checkbox",25),e.NdJ("change",function(o){e.CHM(t);const s=e.oxw();return e.KtG(o?s.masterFilesToggle():null)}),e.qZA(),e.TgZ(2,"button",26)(3,"mat-icon"),e._uU(4,"arrow_drop_down"),e.qZA()()()}if(2&i){const t=e.oxw(),n=e.MAs(57);e.xp6(1),e.Q6J("checked",t.fileSelection.hasValue()&&t.isAllFileSelection())("indeterminate",t.fileSelection.hasValue()&&!t.isAllFileSelection()),e.xp6(1),e.Q6J("disabled",0===t.fileSelection.selected.length)("matMenuTriggerFor",n)}}function j(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"td",27)(1,"mat-checkbox",28),e.NdJ("click",function(o){return o.stopPropagation()})("change",function(o){const r=e.CHM(t).$implicit,m=e.oxw();return e.KtG(o?m.fileSelection.toggle(r):null)}),e.qZA()()}if(2&i){const t=c.$implicit,n=e.oxw();e.xp6(1),e.Q6J("checked",n.fileSelection.isSelected(t))}}function E(i,c){1&i&&(e.TgZ(0,"th",24),e._uU(1," Activity"),e.qZA())}function G(i,c){if(1&i&&(e.TgZ(0,"td",27),e._uU(1),e.qZA()),2&i){const t=c.$implicit;e.xp6(1),e.hij(" ",null==t?null:t.uniqIdentity," ")}}function K(i,c){1&i&&(e.TgZ(0,"th",24),e._uU(1," FileName "),e.qZA())}function V(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"td",37),e.NdJ("click",function(){const s=e.CHM(t).$implicit,r=e.oxw();return e.KtG(r.downloadDocumement(s))}),e._uU(1),e.qZA()}if(2&i){const t=c.$implicit;e.xp6(1),e.hij(" ",null==t||null==t.nestedAttchments?null:t.nestedAttchments.name," ")}}function W(i,c){1&i&&(e.TgZ(0,"th",24),e._uU(1," Size "),e.qZA())}function X(i,c){if(1&i&&(e.TgZ(0,"td",27),e._uU(1),e.qZA()),2&i){const t=c.$implicit;e.xp6(1),e.hij(" ",null==t||null==t.nestedAttchments?null:t.nestedAttchments.size," ")}}function ee(i,c){1&i&&(e.TgZ(0,"th",24),e._uU(1," Organisation "),e.qZA())}function te(i,c){if(1&i&&(e.TgZ(0,"td",27),e._uU(1),e.qZA()),2&i){const t=c.$implicit;e.xp6(1),e.hij(" ",null!=t&&null!=t.docOrg[0]&&t.docOrg[0].organization?null==t||null==t.docOrg[0]?null:t.docOrg[0].organization:null==t||null==t.nestedAttchments?null:t.nestedAttchments.organization," ")}}function ie(i,c){1&i&&e._UZ(0,"tr",33)}function ne(i,c){1&i&&e._UZ(0,"tr",34)}function ce(i,c){1&i&&(e.TgZ(0,"div")(1,"mat-card",35),e._uU(2," No Files found "),e.qZA()())}const oe=[{path:"",component:(()=>{class i{constructor(t,n,o,s,r,m){this.archiveService=t,this.router=n,this.alertpopupService=o,this.documentsService=s,this.activityService=r,this.confirmationService=m,this.archiveActivitiesList=[],this.taskDisplayedColumns=["checkbox","Activity","Title","Status","Organisation"],this.fileDisplayedColumns=["checkbox","Activity","FileName","Size","Organization"],this.dataSource=new l.by(this.archiveActivitiesList),this.selection=new v.Ov(!0,[]),this.archiveDocuments=[],this.paginationProps=f.k,this.fileSelection=new v.Ov(!0,[]),this.displayedColumns=["checkbox","Activity","FileName","Size","Organisation"],this.dataSourceArchiveDocs=new l.by(this.archiveDocuments),this.documentsPayload={pageNumber:0,pageSize:10,sortField:"",groupBy:0,fileNameSearchText:"",organizations:[],isArchived:!0}}ngOnInit(){this.getArchiveActivities(),this.getAllArchiveDocuments()}getArchiveActivities(){this.archiveService.getArchiveActivities().subscribe(t=>{this.archiveActivitiesList=t.data,this.dataSource=new l.by(this.archiveActivitiesList)})}isAllSelected(){return this.selection.selected.length===this.dataSource.data.length}isAllFileSelection(){return this.fileSelection.selected.length===this.archiveDocumentsTotalCount}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.data.forEach(t=>this.selection.select(t))}masterFilesToggle(){this.isAllFileSelection()?this.fileSelection.clear():this.dataSourceArchiveDocs.data.forEach(t=>this.fileSelection.select(t))}logSelection(){this.selection.selected.forEach(t=>{})}navigateToActivityDetails(t){this.router.navigate([A.p.ACTIVITY_DETAILS],{queryParams:{aId:t}})}archiveActionClick(t){if("Restore"===t){const n={activityIds:this.selection.selected.map(o=>o._id),isArchive:!1};this.archiveService.postRestoreSelectedActivities(n).subscribe(o=>{o&&(this.alertpopupService.open({message:o?.message?o?.message:"Activities archived successfully",action:"ok"}),this.getArchiveActivities())},o=>{this.alertpopupService.open({message:o?.message?o?.message:"Failed to archive Activities  ",action:"ok"})})}else"Remove"===t&&this.archiveService.postDeleteSelectedActivities({activityIds:this.selection.selected.map(n=>n._id)}).subscribe(n=>{n&&(this.alertpopupService.open({message:n?.message?n?.message:"Activities removed successfully",action:"ok"}),this.getArchiveActivities())},n=>{this.alertpopupService.open({message:n?.message?n?.message:"Failed to remove Activities  ",action:"ok"})})}getAllArchiveDocuments(){this.documentsService.postActivityAttachments(this.documentsPayload).subscribe(t=>{this.archiveDocuments=t?.data[0]?.attachments,this.archiveDocumentsTotalCount=t?.data[0]?.count[0]?.count,this.dataSourceArchiveDocs=new l.by(this.archiveDocuments)})}onChangedPageSize(t){this.documentsPayload.pageNumber=this.paginator?.pageIndex,this.documentsPayload.pageSize=this.paginator?.pageSize,this.getAllArchiveDocuments()}downloadDocumement(t){const n={fileName:t.nestedAttchments.name,path:`${t._id}`};t.nestedAttchments.activityLogId&&(n.path=`${t._id}/${t.nestedAttchments.activityLogId}`),this.activityService.dowloadAttachments(n).subscribe(o=>{const s=document.createElement("a");s.href=window.URL.createObjectURL(o),s.download=t.nestedAttchments.name,s.click(),window.URL.revokeObjectURL(s.href),this.alertpopupService.open({message:"Attachment downloaded successfully",action:"Ok"})},o=>{this.alertpopupService.open({message:"Attachment Not Found",action:"Ok"})})}removeFile(){const t=this.fileSelection.selected.map(n=>({activityId:n.nestedAttchments.activityId,activityLogId:n.nestedAttchments.activityLogId?n.nestedAttchments.activityLogId:null,attchmentId:n.nestedAttchments._id}));this.confirmationService.open({message:"Are you sure to remove documents"}).afterClosed().subscribe(n=>{n&&this.documentsService.removeDocument(t).subscribe(o=>{this.alertpopupService.open({message:"Documents removed successfully",action:"ok"}),this.getAllArchiveDocuments()},o=>{this.alertpopupService.open({message:o.message?o.message:"Unable to remove document",action:"ok"})})})}restoreFile(){const t=this.fileSelection.selected.map(n=>({activityId:n.nestedAttchments.activityId,activityLogId:n.nestedAttchments.activityLogId?n.nestedAttchments.activityLogId:null,attchmentId:n.nestedAttchments._id}));this.confirmationService.open({message:"Are you sure to restore documents"}).afterClosed().subscribe(n=>{n&&this.archiveService.restoreDocuments(t).subscribe(o=>{this.alertpopupService.open({message:"Documents restored successfully",action:"ok"}),this.getAllArchiveDocuments()},o=>{this.alertpopupService.open({message:o.message?o.message:"Unable to restore document",action:"ok"})})})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(T),e.Y36(d.F0),e.Y36(S.z),e.Y36(x.S),e.Y36(b.M),e.Y36(Z.O))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-archive"]],viewQuery:function(t,n){if(1&t&&e.Gf(_.NW,5),2&t){let o;e.iGM(o=e.CRH())&&(n.paginator=o.first)}},decls:68,vars:11,consts:[["mat-tab-label",""],["mat-table","",1,"mat-elevation-z8","archiveTable",3,"dataSource"],["matColumnDef","checkbox"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","Activity"],["mat-cell","","class","cursor",3,"click",4,"matCellDef"],["matColumnDef","Title"],["matColumnDef","Status"],["mat-header-cell","","class","status-badge",4,"matHeaderCellDef"],["mat-cell","","class","status-badge",4,"matCellDef"],["matColumnDef","Organisation"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[4,"ngIf"],["mat-table","",1,"mat-elevation-z8","documentTable",3,"dataSource"],["matColumnDef","FileName"],["mat-cell","","class","attachment-download",3,"click",4,"matCellDef"],["matColumnDef","Size"],["aria-label","Select page of GitHub search results",3,"length","pageSize","pageSizeOptions","page"],["menu","matMenu"],["mat-menu-item","",3,"click"],["fileMenu","matMenu"],[1,"d-flex","align-items-center","gap-1"],["mat-header-cell",""],[3,"checked","indeterminate","change"],["mat-icon-button","","aria-label","Example icon-button with a menu",3,"disabled","matMenuTriggerFor"],["mat-cell",""],[3,"checked","click","change"],["mat-cell","",1,"cursor",3,"click"],["mat-header-cell","",1,"status-badge"],["mat-cell","",1,"status-badge"],[1,"badge",3,"ngClass"],["mat-header-row",""],["mat-row",""],[1,"noTask-message"],[1,"d-flex","align-items-center","gap-1",3,"click"],["mat-cell","",1,"attachment-download",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"mat-tab-group")(1,"mat-tab"),e.YNc(2,w,4,0,"ng-template",0),e.TgZ(3,"table",1),e.ynx(4,2),e.YNc(5,O,5,4,"th",3),e.YNc(6,U,2,1,"td",4),e.BQk(),e.ynx(7,5),e.YNc(8,M,2,0,"th",3),e.YNc(9,F,2,1,"td",6),e.BQk(),e.ynx(10,7),e.YNc(11,z,2,0,"th",3),e.YNc(12,Y,2,1,"td",6),e.BQk(),e.ynx(13,8),e.YNc(14,J,2,0,"th",9),e.YNc(15,I,4,9,"td",10),e.BQk(),e.ynx(16,11),e.YNc(17,Q,2,0,"th",3),e.YNc(18,L,2,1,"td",4),e.BQk(),e.YNc(19,R,1,0,"tr",12),e.YNc(20,q,1,0,"tr",13),e.qZA(),e.YNc(21,B,3,0,"div",14),e.qZA(),e.TgZ(22,"mat-tab"),e.YNc(23,$,4,0,"ng-template",0),e.TgZ(24,"table",15),e.ynx(25,2),e.YNc(26,H,5,4,"th",3),e.YNc(27,j,2,1,"td",4),e.BQk(),e.ynx(28,5),e.YNc(29,E,2,0,"th",3),e.YNc(30,G,2,1,"td",4),e.BQk(),e.ynx(31,16),e.YNc(32,K,2,0,"th",3),e.YNc(33,V,2,1,"td",17),e.BQk(),e.ynx(34,18),e.YNc(35,W,2,0,"th",3),e.YNc(36,X,2,1,"td",4),e.BQk(),e.ynx(37,11),e.YNc(38,ee,2,0,"th",3),e.YNc(39,te,2,1,"td",4),e.BQk(),e.YNc(40,ie,1,0,"tr",12),e.YNc(41,ne,1,0,"tr",13),e.qZA(),e.TgZ(42,"mat-paginator",19),e.NdJ("page",function(s){return n.onChangedPageSize(s)}),e.qZA(),e.YNc(43,ce,3,0,"div",14),e.qZA()(),e.TgZ(44,"mat-menu",null,20)(46,"button",21),e.NdJ("click",function(){return n.archiveActionClick("Restore")}),e.TgZ(47,"mat-icon"),e._uU(48,"refresh"),e.qZA(),e.TgZ(49,"span"),e._uU(50,"Restore"),e.qZA()(),e.TgZ(51,"button",21),e.NdJ("click",function(){return n.archiveActionClick("Remove")}),e.TgZ(52,"mat-icon"),e._uU(53,"delete"),e.qZA(),e.TgZ(54,"span"),e._uU(55,"Remove"),e.qZA()()(),e.TgZ(56,"mat-menu",null,22)(58,"button",21),e.NdJ("click",function(){return n.restoreFile()}),e.TgZ(59,"mat-icon"),e._uU(60,"refresh"),e.qZA(),e.TgZ(61,"span"),e._uU(62,"Restore"),e.qZA()(),e.TgZ(63,"button",21),e.NdJ("click",function(){return n.removeFile()}),e.TgZ(64,"mat-icon"),e._uU(65,"delete"),e.qZA(),e.TgZ(66,"span"),e._uU(67,"Remove"),e.qZA()()()),2&t&&(e.xp6(3),e.Q6J("dataSource",n.dataSource),e.xp6(16),e.Q6J("matHeaderRowDef",n.taskDisplayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",n.taskDisplayedColumns),e.xp6(1),e.Q6J("ngIf",0===(null==n.dataSource||null==n.dataSource.filteredData?null:n.dataSource.filteredData.length)),e.xp6(3),e.Q6J("dataSource",n.dataSourceArchiveDocs),e.xp6(16),e.Q6J("matHeaderRowDef",n.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",n.displayedColumns),e.xp6(1),e.Q6J("length",n.archiveDocumentsTotalCount)("pageSize",n.paginationProps.pageSize)("pageSizeOptions",n.paginationProps.pageSizeOptions),e.xp6(1),e.Q6J("ngIf",0===n.archiveDocuments.length))},dependencies:[u.mk,u.O5,y.lW,k.a8,D.oG,N.Hw,h.VK,h.OP,h.p6,_.NW,l.BZ,l.fO,l.as,l.w1,l.Dz,l.nj,l.ge,l.ev,l.XQ,l.Gk,p.SP,p.uD,p.uX,u.rS],styles:[".archiveTable[_ngcontent-%COMP%]{width:100%}th[_ngcontent-%COMP%]{background-color:#f0f0f0;font-size:1em}.badge[_ngcontent-%COMP%], .badge-resolved[_ngcontent-%COMP%], .badge-not-admissible[_ngcontent-%COMP%], .badge-in-progress[_ngcontent-%COMP%], .badge-new[_ngcontent-%COMP%]{width:100px;color:#fff;text-align:center;padding:5px 9px;letter-spacing:.1em;font-weight:500;font-size:12px;border-radius:0;text-transform:capitalize}.badge-new[_ngcontent-%COMP%]{background-color:#ffae3ee0}.badge-in-progress[_ngcontent-%COMP%]{background-color:#012970c2}.badge-not-admissible[_ngcontent-%COMP%]{background-color:#ff4b3edb}.badge-resolved[_ngcontent-%COMP%]{background-color:#4bec81}.cursor[_ngcontent-%COMP%]{cursor:pointer}.noTask-message[_ngcontent-%COMP%]{text-align:center;color:#e90e0e}.documentTable[_ngcontent-%COMP%]{width:100%}th.mat-header-cell[_ngcontent-%COMP%]{text-align:left;font-size:1rem;background:#f0f0f0}.attachment-download[_ngcontent-%COMP%]{cursor:pointer;color:#00f;text-decoration:underline}"]}),i})()}];let ae=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[d.Bz.forChild(oe),d.Bz]}),i})();var se=a(1252);let le=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[u.ez,ae,se.m]}),i})()}}]);